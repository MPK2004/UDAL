<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DK ZP - MRF Digital Suite</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --dkzp-blue: #1a3a6c;
            --dkzp-green: #2e7d32;
            --dkzp-gold: #ffc107;
            --dkzp-red: #d32f2f;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-bottom: 60px;
        }
        
        .navbar-brand {
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, var(--dkzp-blue) 0%, #2c5282 100%);
            color: white;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .kpi-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            border-top: 4px solid var(--dkzp-green);
            overflow: hidden;
            position: relative;
            padding: 1.5rem;
            text-align: center;
        }
        
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        
        .kpi-icon {
            font-size: 2.5rem;
            color: var(--dkzp-blue);
            margin-bottom: 1rem;
        }
        
        .kpi-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }
        
        .kpi-title {
            font-size: 1rem;
            color: #6c757d;
            font-weight: 600;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            height: 100%;
            position: relative;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
        }
        
        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dkzp-blue);
            margin: 0;
        }
        
        .material-badge {
            display: inline-block;
            padding: 0.3em 0.6em;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            color: white;
        }
        
        .btn-dkzp {
            background: var(--dkzp-blue);
            color: white;
            font-weight: 600;
            padding: 0.5rem 1.2rem;
            border-radius: 8px;
            border: none;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-dkzp:hover {
            background: #0f2a4d;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .revenue-positive { color: #2e7d32; }
        .revenue-negative { color: #d32f2f; }
        
        .footer {
            background: var(--dkzp-blue);
            color: rgba(255,255,255,0.8);
            padding: 2rem 0;
            margin-top: 3rem;
            position: relative;
            z-index: 100;
        }
        
        .mrf-logo {
            height: 50px;
            margin-right: 15px;
        }
        
        .data-actions {
            display: flex;
            gap: 8px;
        }
        
        .import-export-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px dashed #1a3a6c;
        }
        
        .report-card {
            transition: all 0.3s;
            border: 2px solid transparent;
            height: 100%;
        }
        
        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
            border-color: var(--dkzp-blue);
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .animated-card {
            animation: cardAppear 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes cardAppear {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark dashboard-header">
        <div class="container">
            <div class="d-flex align-items-center">
                <i class="bi bi-recycle" style="font-size: 2rem; margin-right: 15px;"></i>
                <a class="navbar-brand" href="#">
                    DK Zilla Panchayat - MRF Digital Suite
                </a>
            </div>
            <div class="d-flex align-items-center">
                <span class="navbar-text me-3 d-none d-md-block">
                    <i class="bi bi-calendar-check"></i> <span id="current-date-display"></span>
                </span>
                <button class="btn btn-outline-light">
                    <i class="bi bi-person-circle"></i> Operator
                </button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Data Import/Export Card -->
        <div class="import-export-card animated-card">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3><i class="bi bi-database"></i> Data Management</h3>
                <div class="d-flex gap-2">
                    <button class="btn btn-success" onclick="loadSampleData()">
                        <i class="bi bi-database-add"></i> Load Sample Data
                    </button>
                    <button class="btn btn-primary" onclick="exportData()">
                        <i class="bi bi-download"></i> Export All Data
                    </button>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-8">
                    <div class="mb-3">
                        <label for="csvFile" class="form-label">Import CSV Data</label>
                        <div class="input-group">
                            <input class="form-control" type="file" id="csvFile" accept=".csv">
                            <button class="btn btn-dkzp" type="button" onclick="importData()">
                                <i class="bi bi-upload"></i> Import
                            </button>
                        </div>
                        <div class="form-text">Upload your MRF operation records in CSV format</div>
                    </div>
                </div>
                <div class="col-md-4 d-flex align-items-center">
                    <button class="btn btn-dkzp w-100" onclick="generateReport()">
                        <i class="bi bi-file-earmark-pdf"></i> Generate Reports
                    </button>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="row g-4 mb-4">
            <div class="col-md-3">
                <div class="kpi-card animated-card">
                    <div class="kpi-icon">
                        <i class="bi bi-trash3"></i>
                    </div>
                    <div class="kpi-value" id="total-waste">0 kg</div>
                    <div class="kpi-title">TOTAL WASTE PROCESSED</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card animated-card">
                    <div class="kpi-icon">
                        <i class="bi bi-cash-coin"></i>
                    </div>
                    <div class="kpi-value" id="total-revenue">₹0</div>
                    <div class="kpi-title">REVENUE POTENTIAL</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card animated-card">
                    <div class="kpi-icon">
                        <i class="bi bi-speedometer2"></i>
                    </div>
                    <div class="kpi-value" id="avg-daily">0 kg</div>
                    <div class="kpi-title">AVG DAILY WASTE</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="kpi-card animated-card">
                    <div class="kpi-icon">
                        <i class="bi bi-truck"></i>
                    </div>
                    <div class="kpi-value" id="total-loads">0</div>
                    <div class="kpi-title">TODAY'S LOADS</div>
                </div>
            </div>
        </div>

        <!-- Charts and Data Section -->
        <div class="row g-4 mb-4">
            <!-- Waste Trend Chart -->
            <div class="col-lg-8">
                <div class="chart-container animated-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Weekly Waste Trend</h3>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-secondary active">7D</button>
                            <button class="btn btn-sm btn-outline-secondary">30D</button>
                            <button class="btn btn-sm btn-outline-secondary">90D</button>
                        </div>
                    </div>
                    <canvas id="trendChart" height="250"></canvas>
                </div>
            </div>
            
            <!-- Material Distribution -->
            <div class="col-lg-4">
                <div class="chart-container animated-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Material Distribution</h3>
                    </div>
                    <canvas id="materialChart" height="250"></canvas>
                </div>
            </div>
        </div>

        <div class="row g-4 mb-4">
            <!-- Destination Breakdown -->
            <div class="col-lg-5">
                <div class="chart-container animated-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Destination Breakdown</h3>
                    </div>
                    <canvas id="destinationChart" height="300"></canvas>
                </div>
            </div>
            
            <!-- Today's Summary -->
            <div class="col-lg-7">
                <div class="chart-container animated-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Today's Waste Summary</h3>
                        <span class="badge bg-primary">
                            <i class="bi bi-calendar-day"></i> <span id="today-date-display"></span>
                        </span>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Material</th>
                                    <th>Weight (kg)</th>
                                    <th>Revenue</th>
                                    <th>% of Total</th>
                                </tr>
                            </thead>
                            <tbody id="today-summary"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Revenue Potential -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="chart-container animated-card">
                    <div class="chart-header">
                        <h3 class="chart-title">Revenue Potential by Material</h3>
                        <i class="bi bi-currency-rupee"></i>
                    </div>
                    <div id="revenue-chips" class="d-flex flex-wrap mb-3"></div>
                    <canvas id="revenueChart" height="120"></canvas>
                </div>
            </div>
        </div>

        <!-- Report Section -->
        <div id="report-section" class="card mb-4 animated-card" style="display: none;">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h3 class="mb-0"><i class="bi bi-file-earmark-check"></i> Generated Reports</h3>
                <button class="btn btn-sm btn-light" onclick="closeReportSection()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
            <div class="card-body" id="report-links">
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card report-card h-100">
                            <div class="card-body text-center">
                                <i class="bi bi-file-earmark-pdf text-danger" style="font-size: 3rem;"></i>
                                <h5 class="card-title mt-2">PDF Report</h5>
                                <p class="card-text">Comprehensive waste analysis report</p>
                                <div class="d-grid">
                                    <button class="btn btn-danger" id="pdf-download-btn">
                                        <i class="bi bi-download"></i> Download PDF
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card report-card h-100">
                            <div class="card-body text-center">
                                <i class="bi bi-file-earmark-spreadsheet text-success" style="font-size: 3rem;"></i>
                                <h5 class="card-title mt-2">CSV Data</h5>
                                <p class="card-text">Raw data for further analysis</p>
                                <div class="d-grid">
                                    <button class="btn btn-success" id="csv-download-btn">
                                        <i class="bi bi-download"></i> Download CSV
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Dakshina Kannada Zilla Panchayat</h5>
                    <p>Swachh Bharat Mission (Gramin)<br>
                    Material Recovery Facility Monitoring System</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p>
                        <i class="bi bi-envelope"></i> ceozpmlr@nic.in<br>
                        <i class="bi bi-telephone"></i> 9480862000
                    </p>
                    <p>Creating a Zero Waste World Through Circular Economy</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Initialize charts
        let trendChart, materialChart, destinationChart, revenueChart;
        
        function initCharts() {
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            const materialCtx = document.getElementById('materialChart').getContext('2d');
            const destinationCtx = document.getElementById('destinationChart').getContext('2d');
            const revenueCtx = document.getElementById('revenueChart').getContext('2d');
            
            trendChart = new Chart(trendCtx, {
                type: 'line',
                data: { 
                    labels: [], 
                    datasets: [{ 
                        label: 'Waste (kg)',
                        data: [],
                        borderColor: '#1a3a6c',
                        backgroundColor: 'rgba(26, 58, 108, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        fill: true,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#1a3a6c',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }] 
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(26, 58, 108, 0.9)',
                            titleFont: { size: 14 },
                            bodyFont: { size: 13 },
                            padding: 12,
                            displayColors: false
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            title: { 
                                display: true, 
                                text: 'Kilograms',
                                font: { weight: 'bold' }
                            },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: { 
                            title: { 
                                display: true, 
                                text: 'Date',
                                font: { weight: 'bold' }
                            },
                            grid: { display: false }
                        }
                    }
                }
            });
            
            materialChart = new Chart(materialCtx, {
                type: 'doughnut',
                data: { 
                    labels: [], 
                    datasets: [{ 
                        data: [], 
                        backgroundColor: [
                            '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796'
                        ],
                        borderWidth: 0,
                        hoverOffset: 15
                    }] 
                },
                options: {
                    responsive: true,
                    cutout: '65%',
                    plugins: {
                        legend: { 
                            position: 'right',
                            labels: { 
                                font: { size: 12 },
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.chart.getDatasetMeta(0).total;
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value}kg (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            destinationChart = new Chart(destinationCtx, {
                type: 'pie',
                data: { 
                    labels: [], 
                    datasets: [{ 
                        data: [], 
                        backgroundColor: [
                            '#2e59d9', '#17a673', '#2c9faf', '#dda20a', '#e0503e'
                        ],
                        borderWidth: 0,
                        hoverOffset: 15
                    }] 
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { 
                            position: 'right',
                            labels: { 
                                font: { size: 12 },
                                padding: 20
                            }
                        }
                    }
                }
            });
            
            revenueChart = new Chart(revenueCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Revenue Potential (₹)',
                        data: [],
                        backgroundColor: '#2e7d32',
                        borderWidth: 0,
                        borderRadius: 6,
                        barThickness: 20
                    }]
                },
                options: {
                    responsive: true,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        }
                    }
                }
            });
        }

        // Material colors
        const materialColors = {
            "PET": "#4e73df", 
            "HDPE": "#1cc88a", 
            "Paper": "#f6c23e", 
            "Glass": "#36b9cc", 
            "MLP": "#e74a3b", 
            "Rubber": "#858796"
        };
        
        // Material rates (₹/kg)
        const materialRates = {
            "PET": 28, "HDPE": 28, "Paper": 11, "Glass": 2, 
            "MLP": -4, "Rubber": -4
        };
        
        // Fetch and update dashboard data
        async function updateDashboard() {
            try {
                const response = await fetch('/dashboard-data');
                const data = await response.json();
                
                // Update KPIs
                document.getElementById('total-waste').textContent = 
                    `${data.kpis.total_waste.toFixed(2)} kg`;
                document.getElementById('total-revenue').textContent = 
                    `₹${data.kpis.total_revenue.toLocaleString('en-IN', {maximumFractionDigits:2})}`;
                document.getElementById('avg-daily').textContent = 
                    `${data.kpis.avg_daily.toFixed(2)} kg`;
                document.getElementById('total-loads').textContent = 
                    data.today.materials.length;
                
                // Update trend chart
                trendChart.data.labels = data.weekly.labels;
                trendChart.data.datasets[0].data = data.weekly.data;
                trendChart.update();
                
                // Update material chart
                materialChart.data.labels = data.materials.labels;
                materialChart.data.datasets[0].data = data.materials.data;
                materialChart.update();
                
                // Update destination chart
                destinationChart.data.labels = data.destinations.labels;
                destinationChart.data.datasets[0].data = data.destinations.data;
                destinationChart.update();
                
                // Update today's summary
                const tableBody = document.querySelector('#today-summary');
                tableBody.innerHTML = '';
                
                if (data.today.materials.length > 0) {
                    const totalToday = data.today.materials.reduce((sum, item) => sum + item.total, 0);
                    
                    data.today.materials.forEach(item => {
                        const revenue = item.total * materialRates[item.material] || 0;
                        const percentage = totalToday > 0 ? (item.total / totalToday * 100) : 0;
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.material}</td>
                            <td>${item.total.toFixed(2)}</td>
                            <td class="${revenue >= 0 ? 'revenue-positive' : 'revenue-negative'}">₹${revenue.toFixed(2)}</td>
                            <td>${percentage.toFixed(1)}%</td>
                        `;
                        tableBody.appendChild(row);
                    });
                } else {
                    const row = document.createElement('tr');
                    row.innerHTML = '<td colspan="4" class="text-center">No waste records for today</td>';
                    tableBody.appendChild(row);
                }
                
                // Update revenue chips
                const revenueChips = document.getElementById('revenue-chips');
                revenueChips.innerHTML = '';
                
                data.materials.labels.forEach((label, i) => {
                    const revenue = data.materials.data[i] * materialRates[label] || 0;
                    
                    const chip = document.createElement('div');
                    chip.className = 'material-badge';
                    chip.style.backgroundColor = materialColors[label] || '#6c757d';
                    chip.innerHTML = `
                        ${label}: ₹${revenue.toLocaleString('en-IN', {maximumFractionDigits:2})}
                    `;
                    revenueChips.appendChild(chip);
                });
                
                // Update revenue chart
                revenueChart.data.labels = data.materials.labels;
                revenueChart.data.datasets[0].data = data.materials.labels.map(
                    label => data.materials.data[data.materials.labels.indexOf(label)] * materialRates[label] || 0
                );
                revenueChart.update();
                
            } catch (error) {
                console.error('Error fetching dashboard data:', error);
                showNotification('Failed to load data. Please check your connection.', 'danger');
            }
        }
        
        // Import data function
        async function importData() {
            const fileInput = document.getElementById('csvFile');
            if (!fileInput.files || fileInput.files.length === 0) {
                showNotification('Please select a CSV file', 'warning');
                return;
            }
            
            const formData = new FormData();
            formData.append('csv_file', fileInput.files[0]);
            
            showNotification('Importing data...', 'info');
            
            try {
                const response = await fetch('/import-data', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                if (response.ok) {
                    showNotification(result.status, 'success');
                    updateDashboard();
                } else {
                    showNotification(result.error || 'Import failed', 'danger');
                }
            } catch (error) {
                console.error('Error importing data:', error);
                showNotification('Failed to import data', 'danger');
            }
        }
        
        // Export data function
        async function exportData() {
            showNotification('Exporting data...', 'info');
            
            try {
                const response = await fetch('/export-data');
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `mrf_data_${new Date().toISOString().slice(0,10)}.csv`;
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    showNotification('Data exported successfully', 'success');
                } else {
                    const error = await response.text();
                    showNotification(error || 'Export failed', 'danger');
                }
            } catch (error) {
                console.error('Error exporting data:', error);
                showNotification('Failed to export data', 'danger');
            }
        }
        
        // Generate report function
        async function generateReport() {
            showNotification('Generating reports...', 'info');
            
            // Show report section
            const reportSection = document.getElementById('report-section');
            reportSection.style.display = 'block';
            reportSection.scrollIntoView({ behavior: 'smooth' });
            
            try {
                const response = await fetch('/generate-report');
                const reportData = await response.json();
                
                if (reportData.csv && reportData.pdf) {
                    // Update download buttons
                    document.getElementById('pdf-download-btn').onclick = () => {
                        window.location.href = `/view-report/${reportData.pdf}`;
                    };
                    
                    document.getElementById('csv-download-btn').onclick = () => {
                        window.location.href = `/view-report/${reportData.csv}`;
                    };
                    
                    showNotification('Reports generated successfully!', 'success');
                } else {
                    showNotification('No data available for reports', 'warning');
                }
            } catch (error) {
                console.error('Error generating report:', error);
                showNotification('Failed to generate reports', 'danger');
            }
        }
        
        // Close report section
        function closeReportSection() {
            document.getElementById('report-section').style.display = 'none';
        }
        
        // Load sample data
        async function loadSampleData() {
            try {
                const response = await fetch('/load-sample-data');
                if (response.ok) {
                    updateDashboard();
                    showNotification('Sample data loaded successfully! 100 records added.', 'success');
                }
            } catch (error) {
                console.error('Error loading sample data:', error);
                showNotification('Failed to load sample data.', 'danger');
            }
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            // Remove existing toasts
            const existing = document.querySelector('.toast-container');
            if (existing) existing.remove();
            
            const container = document.createElement('div');
            container.className = 'toast-container position-fixed top-0 end-0 p-3';
            
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'assertive');
            toast.setAttribute('aria-atomic', 'true');
            
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="bi ${type === 'success' ? 'bi-check-circle' : 
                                      type === 'danger' ? 'bi-exclamation-circle' : 
                                      'bi-info-circle'} me-2"></i>
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            `;
            
            container.appendChild(toast);
            document.body.appendChild(container);
            
            // Initialize and show toast
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // Auto remove after delay
            setTimeout(() => {
                bsToast.dispose();
                container.remove();
            }, 5000);
        }
        
        // Format date for display
        function formatDate(date) {
            return date.toLocaleDateString('en-IN', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize charts
            initCharts();
            
            // Set current dates
            const now = new Date();
            document.getElementById('current-date-display').textContent = formatDate(now);
            document.getElementById('today-date-display').textContent = now.toISOString().split('T')[0];
            
            // Initial data load
            updateDashboard();
            
            // Update data every 5 minutes
            setInterval(updateDashboard, 300000);
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>